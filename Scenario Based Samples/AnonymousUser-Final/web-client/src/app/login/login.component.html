<link href="https://cdn.syncfusion.com/ej2/28.1.33/fluent.css" rel="stylesheet"/>

<div class="login-container container">
  <h3><b>Multi tenant Row-Level Security in Bold BI® Demo</b></h3>
  <p>This sample demonstrates how <b>Row-Level Security (RLS)</b> works in a multi-tenant environment using <b>Bold BI®</b>. It provides two distinct access approaches:</p>
  <div class="d-flex justify-content-between align-items-start">
    <!-- Left Side: Login Form -->
    <div class="login-box" style="width: 30%;">
      <br><br>
      <h2 class="login-header">Login</h2>
      <form (ngSubmit)="onSubmit()">
        <label for="useremail" style="display: block; font-weight: bold;">User email</label>
        <div>
          <ejs-combobox id='useremail' #sample [dataSource]='filteredData' name="useremail" [fields]='fields'
            [(ngModel)]="selectedUser" [popupHeight]='height' [placeholder]="'Select the User email address'"
            (change)="onUserChange($event)" allowFiltering="true" (filtering)="onFiltering($event)"></ejs-combobox>
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" name="password" [(ngModel)]="password" required />
        </div>
  
        <button type="submit" class="login-button">Login</button>
      </form>
      <div class="error-message" *ngIf="loginError">{{ loginError }}</div>

      <div *ngIf="showPopup" class="popup-overlay">
        <div class="popup-content">
          <button type="button" class="close-btn" (click)="closePopup()">✖</button>
          <h3 class="popup-header">Flow Diagram - Multi Tenant - Row-Level security</h3>
          <img src="assets/anonymousFlowchart.jpg" alt="Workflow Diagram" class="popup-image" />
        </div>
      </div>
      
      <div class="button-container">
        <button type="button" class="btn btn-primary show-popup-btn advanced-btn" (click)="openPopup()">
      Show Workflow Diagram
    </button>
    </div>


    </div>
    <hr class="divider">

    <!-- Right Side: Paragraph Text -->
    <div class="info-text" style="width: 65%; font-size:small;">
      <div class="button-container" style="padding-left: 70%;">
        <button type="button" class="btn btn-primary advanced-btn" (click)="openPopup1()">
      View Bold BI Server Details here!
    </button>
    </div>
    <ol>
      <li>Authenticated Users (Bold BI Users):</li>
      <ul>
        <li>Users must be present in Bold BI, and their username must be passed via the authorization server.</li>
        <li>The system applies built-in <b>row-level security (RLS)</b> based on user filters defined in Bold BI.</li>
        <li>Alternatively, external filter parameters can be used to refine user-specific data access.</li>
      </ul>
    
      <li>Anonymous Users (Guest Access with Group-Based Permissions):</li>
      <ul>
        <li>Users do not need to be present in Bold BI when the <b>anonymous feature</b> is enabled. However a <b>group present in Bold BI</b> must be passed as parameter.</li>
        <li>Row-level security is applied based on externally passed filter parameters.</li>
        <li>Alternatively, RLS can be configured in <b>Bold BI's user filter feature for groups</b>.</li>
        <ul><li>Example: A <b>Sales</b> group may see only sales-related data, while a Finance group may have access to financial reports only.</li></ul>
      </ul>
    </ol>
    
    <p>How this works:<p>
      <ul>
        <li>When a user logs in, the system applies the appropriate row-level security settings.</li>
        <li>If a user accesses the dashboard anonymously, the embedding layer ensures data visibility based on <b>group-level filters</b>.</li>
        <li>The system dynamically switches data sources (databases) based on <b>custom attributes and filters</b> to ensure secure and personalized access.</li>
        <li>The <b>embed secret</b> code used in the authorization server, in combination with the user or group, acts as an authentication layer for embedding. Ensure the embed secret is securely handled in the code.</li>
      </ul>
    </div>
    
  </div>

  <div *ngIf="showPopup1" class="popup-overlay">
    <div class="popup-content1">
      <button type="button" class="close-btn" (click)="closePopup1()">✖</button>
      <h3 class="popup-header">Bold BI Server</h3>
       <p>The Bold BI Server below is being used for this Multi tenant Row-Level Security sample. You can log in to the server using the credentials provided below to verify the user and group details in the Bold BI® Server.</p>
      <div>
        <table class="server-table" border="1" cellspacing="0" cellpadding="8">
                <tr>
                  <td>Server URL</td>
                  <td><a href="https://demo-analytics.boldbidemo.com/" target="_blank" style="text-decoration: none;">https://demo-analytics.boldbidemo.com</a></td>
                </tr>
                <tr>
                  <td>Username</td>
                  <td>testuser</td>
                </tr>
                <tr>
                  <td>Email</td>
                  <td>testuser@boldbi.com</td>
                </tr>
                <tr>
                  <td>Password</td>
                  <td>@Testuser492</td>
                </tr>
        </table>
      </div>   
    </div>
  </div>
  
  
  <!-- Table Below -->
    <div class="table-container mt-4" style="overflow-y: auto; border: 1px solid #ddd; font-size:small; margin-top: 5px !important">
    <table class="table table-bordered">
        <thead style="position: sticky; top: 0; background: #007bff; z-index: 10;">
          <tr>
            <th>Tenant</th>
            <th>Username</th>
            <th>User Email</th>
            <th>Database Mapping(Custom Attribute)</th>
            <th>Row-Level Security(Filter Parameter)</th>
            <th>Group Name</th>
            <th>Access Type</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of userData; let i = index">
            <td *ngIf="shouldShowRowspan(userData, i)" [attr.rowspan]="4">
              {{ user.tenant }}
            </td>
            <td>{{ user.username }}</td>
            <td>{{ user.email }}</td>
            <td *ngIf="shouldShowRowspan(userData, i)" [attr.rowspan]="4">
              {{ user.customattribute }}
            </td>
            <td>{{ user.filterparameter }}</td>
            <td>
              {{ user.groupName }}
            </td>
            <td>{{ user.access }}</td>
          </tr>
        </tbody>
    </table>
  </div>
</div>
